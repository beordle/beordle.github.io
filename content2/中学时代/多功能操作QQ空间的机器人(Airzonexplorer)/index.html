<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kinton</title>

<link rel="stylesheet" type="text/css" href="/static/style.css">
<link rel="stylesheet" type="text/css" href="/static/aimly.css">
<link rel="stylesheet" type="text/css" href="/static/pygments.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>


<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script type='text/javascript' src='/static/jquery.pjax.js'></script>
<script type="text/javascript" src="/static/toc.js"></script>
<script type="text/javascript" src="http://youbbs.sinaapp.com/static/highligt/highlight.pack.js"></script>
<link rel="stylesheet" type="text/css" href="/static/aimly.css" />
<link rel="stylesheet" type="text/css" href="/static/zenburn.css" />

<link rel="stylesheet" type="text/css" href="http://youbbs.sinaapp.com/static/highligt/sunburst.min.css" />
<script>hljs.initHighlightingOnLoad();</script>

</head>  

<body  data-spy="scroll" data-target=".scrollspy">
        <style>


#toc {

}

#toc ul {
    margin: 0;
    padding: 0;
    list-style: none;
}

#toc li {
    padding: 5px 10px;
}

#toc a {

    text-decoration: none;
    display: block;
}

#toc .toc-h2 {
    padding-left: 10px;
}

#toc .toc-h3 {
    padding-left: 20px;
}

#toc .toc-active {
    background: #336699;
    box-shadow: inset -5px 0px 10px -5px #000;
}

    </style>

  <aside>
    <div id="user_meta">
      <a href="">
        
        <img src="/static/logo.png" alt="logo">
        
      </a>
      <h2><a href="">Beordle</a></h2>
      <p></br>这里隐藏了</br>许多可能有用的东西喔</br>基于知识共享协议</p>

<!-- 多说最新评论 start -->
  <div class="ds-recent-comments" data-num-items="3" data-show-avatars="1" data-show-time="0" data-show-title="0" data-show-admin="0" data-excerpt-length="20"></div>
<!-- 多说最新评论 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"zhangjindong"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->


      
    </div>
  </aside>

  <main>
    <!--header>
      <p>
      <a href="ff">Index</a> &brvbar; <a href="ff/archives.html">Archives</a>
      </p>
    </header-->




<div class="row"  id="main" >
<div id="singletitle"><p>多功能操作QQ空间的机器人(Airzonexplorer)</p></div>
            <div id="content" class="col-md-offset-1 col-md-9"   >

                        <div class="body-wrap">
                                    <div  class="entry-content">

                                                
                                                    <p>这是一个能够操纵QQ空间的Python的类，基本功能大概 有刷空间，或者是自动发个人状态，查看好友资料等等。这个脚本花了我两天时间(2010.5.22,2010.5.23)现在终于是成了样子了。而且这个脚本可以在Google App Engine上运行（花了一下午调试）。 以后可以在此基础上做一个心情机器人（自动把你在干什么更新，不过未完成）或是踩空间的机器人了（这个已经已完成，今天刷了400次。因为一个QQ只能刷100次） 不久的将来会提供下载 </p>
<p>```</p>
<h1>coding:utf-8</h1>
<h1>function preprocess(A)</h1>
<h1>{var B="";B+=A.verifycode.value;B=B.toUpperCase();A.p.value=md5(md5_3(A.p.value)+B);return true}</h1>
<h1>function md5_3(B)</h1>
<h1>{var A=new Array;A=core_md5(str2binl(B),B.length<em>chrsz);A=core_md5(A,16</em>chrsz);A=core_md5(A,16*chrsz);return binl2hex(A)}</h1>
<h1>function md5(A)</h1>
<h1>{return hex_md5(A)}</h1>
<h1>http://ptlogin2.qq.com/check?uin=373866172&amp;appid=15004501&amp;r=0.8188270020846197</h1>
<h1>http://ptlogin2.qq.com/login?u=373866172&amp;p=C9963335029726E3FF5A39D90171763A&amp;verifycode=!M71&amp;aid=15004501&amp;u1=http%3A%2F%2Fimgcache.qq.com%2Fqzone%2Fv5%2Floginsucc.html&amp;h=1&amp;ptredirect=0&amp;ptlang=2052&amp;from_ui=1&amp;dumy=&amp;fp=loginerroralert</h1>
<h1>尚未模拟的请求</h1>
<h1>日记分类</h1>
<h1>http://b.cnc.qzone.qq.com/cgi-bin/blognew/blog_get_category?uin=790448668&amp;r=0.6558689336575223&amp;g_tk=561036914</h1>
<h1>日志信息</h1>
<h1>http://b.cnc.qzone.qq.com/cgi-bin/blognew/blog_get_countlist?type=1&amp;uin=790448668&amp;blogids=1274281473&amp;blogids=1274191926&amp;blogids=1273668455&amp;blogids=1273500595&amp;blogids=1273231895&amp;blogids=1272793772&amp;blogids=1272549604&amp;blogids=1272446999&amp;blogids=1272101325&amp;blogids=1271562898&amp;blogids=1271431993&amp;blogids=1271075298&amp;blogids=1270642953&amp;blogids=1270393847&amp;blogids=1268999236&amp;r=0.8619854742499127&amp;g_tk=561036914</h1>
<h1>TAG列表，没嘛用</h1>
<h1>http://b.cnc.qzone.qq.com/cgi-bin/blognew/blog_get_taglists?reqtype=0&amp;loginuin=373866172&amp;hostuin=790448668&amp;reqtype=0&amp;rnd=1274492168690&amp;g_tk=561036914</h1>
<h1>未知用途</h1>
<h1>http://statistic.qzone.qq.com/cgi-bin/staytime_stat.cgi?muin=790448668&amp;guin=373866172&amp;stay_time=48.37</h1>
<h1>日志列表</h1>
<h1>http://b.cnc.qzone.qq.com/cgi-bin/blognew/blog_output_toppage?uin=790448668&amp;vuin=373866172&amp;property=GoRE&amp;getall=1&amp;styledm=cnc.qzonestyle.gtimg.cn&amp;imgdm=cnc.qzs.qq.com&amp;bdm=b.cnc.qzone.qq.com&amp;cate=&amp;numperpage=15&amp;maxlen=68&amp;sorttype=0&amp;arch=0&amp;pos=0&amp;direct=1&amp;timestamp=1274492105&amp;rand=0.33242965893257204</h1>
<h1>激动中，终于可以登录QZONE了</h1>
<h1>官方JavaScript的实现,我翻译了一下</h1>
<h1>我搞了老半天呢...</h1>
<p>import urllib,urllib2,hashlib</p>
<p>class QQZone():
  def <strong>init</strong>(self):
    try:
      from google.appengine.api import urlfetch
      self.cookie=True
    except:
      self.cookie=None
    self.enablecookie()</p>
<p>def c(self,s):
    #编码辅助小函数#utf2gbk
    return s.decode("utf-8").encode("gbk")</p>
<p>def getverifycode(self,uin):
    "返回临时的验证码"
    def ptui_checkVC(a,verifycode):
      return verifycode
    code="http://ptlogin2.qq.com/check?</p>
<p>uin="+uin+"&amp;appid=15004501&amp;r=0.8188270020846197"
    return eval(urllib2.urlopen(code).read()[:-1])</p>
<p>def preprocess(self,password,verifycode):
    "将密码进行2次MD5为A，将A再次MD5(但是以大写HEX文本方式输出)与加上验证码的大写</p>
<p>形式合并字符串,再次MD5为HEX文本"""
    def md5_3(s):
      return hashlib.md5(hashlib.md5(hashlib.md5(s).digest()).digest</p>
<p>()).hexdigest().upper()
    def md5(s):
      return hashlib.md5(s).hexdigest().upper()
    return md5(md5_3(password)+verifycode.upper() )</p>
<p>def enablecookie(self):
    "启用Cookie"
    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor())
    urllib2.install_opener(opener)</p>
<p>def login(self,uin,password):
    "Qzone登录,返回True为成功，False为登录失败"
    def ptuiCB(a,b,c,d):
      if c=="http://imgcache.qq.com/qzone/v5/loginsucc.html":
         return True
      else:
         return False</p>
<pre><code>def logincookie(cookie):
  #QZone对Cookie有着严格的要求
  ret = ''
  for v in cookie.values():
    if v.key in ["skey","uin","ptcz","pt2gguin"]:
      ret += '%s=%s; ' % (v.key, v.value)
  return ret[:-2]
self.password=password
self.uin=uin
if self.cookie!=None:
  verifycode=self.getverifycode(uin)
  p=self.preprocess(password,verifycode)
  page="http://ptlogin2.qq.com/login?u="+  uin  +"&amp;p="+   p
</code></pre>
<p>+"&amp;verifycode="+  verifycode  +"&amp;aid=15004501&amp;u1=http%3A%2F%2Fimgcache.qq.com%</p>
<p>2Fqzone%2Fv5%</p>
<p>2Floginsucc.html&amp;h=1&amp;ptredirect=0&amp;ptlang=2052&amp;from_ui=1&amp;dumy=&amp;fp=loginerroralert"
      req = urllib2.Request(page)
      req=urllib2.urlopen(req)
      try:
        setcookie=req.headers['Set-Cookie']
      except:
        return
      if eval(req.read()[:-3])==True:
        import Cookie
        setcookie=Cookie.SimpleCookie(setcookie)
        self.cookie=logincookie(setcookie)
      else:
        return
    verifycode=self.getverifycode(uin)
    p=self.preprocess(password,verifycode)
    page="http://ptlogin2.qq.com/login?u="+  uin  +"&amp;p="+   p   +"&amp;verifycode="+  </p>
<p>verifycode  +"&amp;aid=15004501&amp;u1=http%3A%2F%2Fimgcache.qq.com%2Fqzone%2Fv5%</p>
<p>2Floginsucc.html&amp;h=1&amp;ptredirect=0&amp;ptlang=2052&amp;from_ui=1&amp;dumy=&amp;fp=loginerroralert"
    return eval(urllib2.urlopen(page).read()[:-3])</p>
<p>def footprint(self,hostuin):</p>
<h1>"""</h1>
<h1>如果不出意外的话应该是返回如下的字典，就我对QZONE的了解我所能知道的含义是</h1>
<h1>love爱心指数</h1>
<h1>rain雨露指数</h1>
<h1>dayvisit当日浏览次数</h1>
<h1>level等级</h1>
<h1>sun阳光指数</h1>
<h1>visitcount总浏览次数</h1>
<h1>{'love': 746, 'rain': 1111, 'nutri': 399, 'dayvisit': 48, 'retcode': 1, 'level':</h1>
<h1>5, 'sun': 1974, 'markchange': 0, 'visitcount': 2992, 'spacemark': 0, 'gardener'</h1>
<h1>: 8}</h1>
<h1>"""</h1>
<pre><code>def visitCountCallBack(dic):
  return dic
url="http://g.cnc.qzone.qq.com/fcg-bin/cgi_emotion_list.fcg?
</code></pre>
<p>uin="+hostuin+"&amp;loginUin="+self.uin+"&amp;s=885292"</p>
<pre><code>if self.cookie!=None:
   headers = { 'Cookie' : self.cookie }
   req = urllib2.Request(url, None, headers)
else:
   req = urllib2.Request(url)

response = urllib2.urlopen(req)
try:
  return eval(response.read()[:-1])
except:
  return False
</code></pre>
<p>def getnick(self,uin):
    """
  得到指定QQ的昵称
支持多QQ。如'373866172,99480963'
返回诸如以下结果
{"99480963":</p>
<p>["http://imgcache.qq.com/qzone_v4/client/userinfo_icon/5001.gif",3,0,0,0,0," </p>
<p>snow",0],"373866172":</p>
<p>["http://qlogo1.store.qq.com/qzonelogo/373866172/1/1274489190",383,3,0,0,0,"Pure </p>
<p>Gold",0]}
    """
    def portraitCallBack(dic):
      return dic
    page="http://base.cnc.qzone.qq.com/fcg-bin/cgi_get_portrait.fcg?</p>
<p>uins="+uin+"&amp;get_nick=1"
    return eval(urllib2.urlopen(page).read()[:-1]) </p>
<p>def getrightquestion(self,uin):
    #获取Qzone鉴权问题,暂时只返回第一个问题，返回多个我用不到
    def _Callback(a):
      return a["items"][0]["q"].decode("utf-8").encode("gbk")
    r = urllib2.Request("http://base.qzone.qq.com/cgi-</p>
<p>bin/right/get_rightquestion_only.cgi?uin="+uin)
    return eval(urllib2.urlopen(r).read()[:-2])</p>
<p>def rightquestion(uin,answer,question):
   #Qzone鉴权
   #GET
    url = "http://base.qzone.qq.com/cgi-bin/user/cgi_auth"
    params = urllib.urlencode([
      ('uin',uin),
      ('mode','2'),
      ('answer',answer),
      ('question',question),
      ])
    req = urllib2.Request(url)
    return urllib2.urlopen(req,params).read().find(c("鉴权成功"))!=-1</p>
<h1>虽然写了，但是我也不知道干嘛用的</h1>
<p>def keepalive(self,hostuin,uin):
    page="http://statistic.qzone.qq.com/cgi-bin/staytime_stat.cgi?</p>
<p>muin="+hostuin+"&amp;guin="+uin+"&amp;stay_time=19.215&amp;clickstream="
    return urllib2.urlopen(page).read()</p>
<p>def buddystate(self):
    page="http://sns.qq.com/buddy_state/feed/?webqq_t=1274502131581"
    text=urllib2.urlopen(page).read()
    a=eval( text[text.index("=")+1:-1] )["result"]
    return a#有个重大未解决问题</p>
<p>def ownqqmel(self):
    #印象
    page="http://apps.qq.com/app/yx/cgi-bin/show_mel?</p>
<p>hc=8&amp;lc=4&amp;time=1274502131586"
    return urllib2.urlopen(page).read().decode("utf-8")</p>
<p>def qqmel(self):
    #印象
    page="http://apps.qq.com/app/yx/cgi-bin/get_web_feeds?</p>
<p>hc=6&amp;lc=4&amp;c=20&amp;u1=913073915&amp;u2=499986297&amp;u3=164752478&amp;u4=610001229&amp;u5=790448668&amp;u</p>
<p>6=676233546&amp;u7=313057725&amp;u8=451307297&amp;u9=312297502&amp;u10=691374207&amp;u11=1103177265&amp;u</p>
<p>12=741448752&amp;u13=652393872&amp;u14=540601476&amp;u15=377206775&amp;u16=425315602&amp;u17=44491996</p>
<p>4&amp;u18=472820903&amp;u19=100985700&amp;u20=956232214&amp;webqq_t=1274502132420"
    return urllib2.urlopen(page).read().decode("utf-8")</p>
<p>def weather(self):
    #当地天气  GAE不可用
    page="http://www.soso.com/tb.q?</p>
<p>fn=WEBQQ.obj.QQClient.mainPanel.handleLoadWeather"
    return urllib2.urlopen(page).read().decode("utf-8")</p>
<p>#登录,重试几次，以免登陆不上
  def trylogin(self,uin,password,times=6):
    self.uin=uin
    self.password=password
    x=0;success=False
    while (not success) and x&lt;times:
      success=self.login(uin,password)
      x+=1
    return success</p>
<p>def setpublish(self,text,sync=False):
      #text必须是UTF-8编码才行,以qm开头代表同步到QQ签名
      if sync==True:
        text="qm"+text
      url = "http://taotao.qq.com/cgi-bin/emotion_cgi_publish"
      search = urllib.urlencode([('con',text),('who','1')])
      if self.cookie!=None:
        headers={'Cookie':self.cookie}
        req = urllib2.Request(url,None,headers)
      else:
        req = urllib2.Request(url)
      fd = urllib2.urlopen(req,search)
      return
  #获得某人个人信息
  def infocard(self,hostuin):
  #{'astro': 11, 'offsetBirth': 311, 'from': '\xe5\x8d\x97\xe5\xbc\x80', 'qzone': </p>
<p>2, 'avatarUrl': 'http://qlogo1.store.qq.com/qzonelogo/373866172/1/1274489190', </p>
<p>'isFriend': 1, 'nickname': 'Pure Gold', 'uin': 373866172}
    def _Callback(dic):
      return dic
    page="http://base.cnc.qzone.qq.com/cgi-bin/user/cgi_personal_card?</p>
<p>uin="+hostuin
    text=urllib2.urlopen(page).read()
    return eval(text[:text.index(";")])
  #获得最近的个人状态更新
  def lastpublish(self,hostuin):
    """callback({
   "archive" : 1,
   "items" : [
      {
         "archive" : -1,
         "comment" : 0,
         "effect" : -1,
         "expression" : -1,
         "id" : "bcbe4816f1c5f84ba5560400",
         "pubDate" : "2010-05-23 14:06:41",
         "pubTime" : "约1小时前",
         "title" : "有了这些机器人，以后做事方便了许多..."
      }
   ]
}
)"""
    def callback(dic):
      return dic["items"]
    page="http://taotao.qq.com/cgi-bin/emotion_cgi_firstutf8?uin="+hostuin
    text=urllib2.urlopen(page).read()
    return eval(text)
```</p>
                                                <div class="ds-thread" data-thread-key="123" data-title="123" data-url="http://beordle.com/ff6476"></div>
                                    </div>
                        </div>
            </div>

                          <div  class="col-md-2 ">
                                 <div id="toc" class="affix"></div>
                          </div>


 </div>


    <script type="text/javascript">

      var duoshuoQuery = {short_name:"zhangjindong"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = false;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
        <script>


    </script>




    <div id="ending_message">
      <p>&copy; Beordle. Built using Aimly. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. Member of the <a href="#">COPA</a>.</p>
    </div>



<script>

      var duoshuoQuery = {short_name:"zhangjindong"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = false;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();

function pajx_loadDuoshuo(){

  var dus=$(".ds-thread");
  if($(dus).length==1){
    var el = document.createElement('div');
    el.setAttribute('data-thread-key',$(dus).attr("data-thread-key"));//必选参数
    el.setAttribute('data-url',$(dus).attr("data-url"));
    DUOSHUO.EmbedThread(el);
    $(dus).html(el);
    
  }
}

$(document).ready(function(){
  //alert($().pjax);
  $(document).pjax("a", "#main");
  //$.pjax.enable();
  hljs.initHighlightingOnLoad();
  $('#toc').toc();

});

 
$(document).on('pjax:complete', function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
});
  $('#toc').toc();
    pajx_loadDuoshuo();
})
</script>
  </body>
</html>
