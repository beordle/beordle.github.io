title:QQ Monitor Serve Version 1.1(Free&Opensource QQ好友提醒)
date:2010-05-09-07-55
---
<div id="blogDetailDiv" style="font-size:14px;">&#13;
                                                &#13;
                                                <span style="color: #008080;"><div><font class="Apple-style-span" color="#008000">QQmonior是一个需要运行于</font><font class="Apple-style-span" color="#CC0000">Google App Engine</font><font class="Apple-style-span" color="#008000">上以替换超级QQ中的好友（在线）提醒服务的程序。涉及的Google服务有Voice以及Calendal，其实Google Voice是不必用到的，但是为了SMS提醒能更快更稳定地到达，我使用了Voice来发送短信。相对于超级QQ的好友提醒，它有10Sec的</font><span class="Apple-style-span" style="color: rgb(0, 128, 0); line-height: 20px; ">速度</span><span class="Apple-style-span" style="color: rgb(0, 128, 0); line-height: 20px; ">延迟，但是它是完全免费的，否则我怎么会写这样一个程序呢。更重要的是，我想要记录QQ在线情况，这个很适合我(因为自己写的嘛</span><span class="Apple-style-span" style="color: rgb(0, 128, 0); line-height: 20px; "><img src="/qzone/em/e140.gif"/></span><span class="Apple-style-span" style="color: rgb(0, 128, 0); line-height: 20px; ">)。不过它现在对我来说已经没有任何用处了。我想，也许几年以后还会有用的吧，至于以后用不用改这个源代码，我认为99.9%还是会的。(我说的很隐晦)怎么形容我的想法呢，我现在没有任何感觉，就是很压抑，不停地叹息。叹息不是说只因为失败，那不至于，而是与他人相对比来说，我高中的命运实在要悲惨的多。想要脱离悲惨的感觉，可以看看黑格尔的原著啊，那获益良多。看了马克思的，只能是越看越觉得悲惨。</span></div><div><font class="Apple-style-span" color="#008000"><span class="Apple-style-span" style="line-height: 20px;"><br/></span></font></div><div><span class="Apple-style-span" style="line-height: 20px;"><font class="Apple-style-span" color="#0000FF"><b>未来将会做成Web应用以分享...</b></font></span></div><div><font class="Apple-style-span" color="#008000"><span class="Apple-style-span" style="line-height: 20px;"><br/></span></font><div><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', monospace; line-height: normal; font-size: 12px; white-space: pre; "><span style="color: rgb(0, 128, 128); "> 1</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">coding:utf-8</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); "> 2</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 255); ">from</span><span style="color: rgb(0, 0, 0); "> wsgiref </span><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> handlers
</span><span style="color: rgb(0, 128, 128); "> 3</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">from</span><span style="color: rgb(0, 0, 0); "> google.appengine.ext </span><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> webapp
</span><span style="color: rgb(0, 128, 128); "> 4</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> time
</span><span style="color: rgb(0, 128, 128); "> 5</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">1252offline</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); "> 6</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">from</span><span style="color: rgb(0, 0, 0); "> urllib </span><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> urlopen
</span><span style="color: rgb(0, 128, 128); "> 7</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> time
</span><span style="color: rgb(0, 128, 128); "> 8</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> gdata.calendar.service
</span><span style="color: rgb(0, 128, 128); "> 9</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> gdata.service
</span><span style="color: rgb(0, 128, 128); ">10</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> atom.service
</span><span style="color: rgb(0, 128, 128); ">11</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> gdata.calendar
</span><span style="color: rgb(0, 128, 128); ">12</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> atom
</span><span style="color: rgb(0, 128, 128); ">13</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">from</span><span style="color: rgb(0, 0, 0); "> datalib </span><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> datalib
</span><span style="color: rgb(0, 128, 128); ">14</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">自己写的数据库封装,支持多种对象，因为它自动序列化</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">15</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">16</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">class</span><span style="color: rgb(0, 0, 0); "> MainFrame(webapp.RequestHandler):
</span><span style="color: rgb(0, 128, 128); ">17</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">18</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> get(self):
</span><span style="color: rgb(0, 128, 128); ">19</span> <span style="color: rgb(0, 0, 0); ">lib</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">datalib.data()
</span><span style="color: rgb(0, 128, 128); ">20</span> <span style="color: rgb(0, 0, 0); ">self.response.out.write(Change())
</span><span style="color: rgb(0, 128, 128); ">21</span> <span style="color: rgb(0, 0, 0); ">self.response.out.write(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">&lt;title&gt;已更新&lt;/title&gt;</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">)
</span><span style="color: rgb(0, 128, 128); ">22</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">23</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> Change():
</span><span style="color: rgb(0, 128, 128); ">24</span> <span style="color: rgb(0, 0, 0); ">lib</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">datalib.data()
</span><span style="color: rgb(0, 128, 128); ">25</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">if</span><span style="color: rgb(0, 0, 0); "> lib.online </span><span style="color: rgb(0, 0, 255); ">is</span><span style="color: rgb(0, 0, 0); "> None:</span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">代表首次运行</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">26</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "> lib.online</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">False</span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">初始化为不在线</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">27</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">else</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">28</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">如果状态没有改变</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">29</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">if</span><span style="color: rgb(0, 0, 0); "> QQonline()</span><span style="color: rgb(0, 0, 0); ">==</span><span style="color: rgb(0, 0, 0); ">lib.online:
</span><span style="color: rgb(0, 128, 128); ">30</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">pass</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">31</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">else</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">32</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">否则更新状态,并生成事件</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">33</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "> lib.online</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 255); ">not</span><span style="color: rgb(0, 0, 0); "> lib.online
</span><span style="color: rgb(0, 128, 128); ">34</span> <span style="color: rgb(0, 0, 0); "> online</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">lib.online </span><span style="color: rgb(0, 0, 255); ">and</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">在线</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">or</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">离线</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">35</span> <span style="color: rgb(0, 0, 0); "> eonline</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">lib.online </span><span style="color: rgb(0, 0, 255); ">and</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">Online</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">or</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">Offline</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">36</span> <span style="color: rgb(0, 0, 0); "> urlopen(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); "><a href="http://beordle.appspot.com/app/smsbomber/send?text=" target="_blank">http://beordle.appspot.com/app/smsbomber/send?text=</a></span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">+</span><span style="color: rgb(0, 0, 0); ">eonline)
</span><span style="color: rgb(0, 128, 128); ">37</span> <span style="color: rgb(0, 0, 0); "> UpdateEvent(online)
</span><span style="color: rgb(0, 128, 128); ">38</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">39</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> UpdateEvent(title</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(128, 0, 0); ">""</span><span style="color: rgb(0, 0, 0); ">,content</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(128, 0, 0); ">""</span><span style="color: rgb(0, 0, 0); ">,email</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">beordle@gmail.com</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">,password</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">9461135698</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">):
</span><span style="color: rgb(0, 128, 128); ">40</span> <span style="color: rgb(0, 0, 0); ">cal_client </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> gdata.calendar.service.CalendarService()
</span><span style="color: rgb(0, 128, 128); ">41</span> <span style="color: rgb(0, 0, 0); ">cal_client.email </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> email
</span><span style="color: rgb(0, 128, 128); ">42</span> <span style="color: rgb(0, 0, 0); ">cal_client.password </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> password
</span><span style="color: rgb(0, 128, 128); ">43</span> <span style="color: rgb(0, 0, 0); ">cal_client.source </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(128, 0, 0); ">QQmonitor v1.0</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">44</span> <span style="color: rgb(0, 0, 0); ">cal_client.ProgrammaticLogin()
</span><span style="color: rgb(0, 128, 128); ">45</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">获取日历名称:不过我就是这个，不用浪费了</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">46</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">feed = cal_client.GetOwnCalendarsFeed()</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">47</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">for calendar in feed.entry:</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">48</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">if calendar.title.text=="张鹤竞":</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">49</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">#实际可能不止一个</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">50</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">calname='/calendar/feeds/'+calendar.id.text[len("<a href="http://www.google.com/calendar/feeds/default/owncalendars/full" target="_blank">http://www.google.com/calendar/feeds/default/owncalendars/full</a>")+1:]+'/private/full'</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">51</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">break</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">52</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">添加事件</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">53</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); ">calname</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">/calendar/feeds/3khc5ql623f3s51k9huc02qpt0%40group.calendar.google.com/private/full</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">54</span> <span style="color: rgb(0, 0, 0); ">event </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> gdata.calendar.CalendarEventEntry()
</span><span style="color: rgb(0, 128, 128); ">55</span> <span style="color: rgb(0, 0, 0); ">event.title </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> atom.Title(text</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">title)
</span><span style="color: rgb(0, 128, 128); ">56</span> <span style="color: rgb(0, 0, 0); ">start_time </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> time.strftime(</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(128, 0, 0); ">%Y-%m-%dT%H:%M:%S.000Z</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(0, 0, 0); ">, time.gmtime(time.time()</span><span style="color: rgb(0, 0, 0); ">+</span><span style="color: rgb(0, 0, 0); ">10</span><span style="color: rgb(0, 0, 0); ">))
</span><span style="color: rgb(0, 128, 128); ">57</span> <span style="color: rgb(0, 0, 0); ">end_time </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> time.strftime(</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(128, 0, 0); ">%Y-%m-%dT%H:%M:%S.000Z</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(0, 0, 0); ">,time.gmtime(time.time()</span><span style="color: rgb(0, 0, 0); ">+</span><span style="color: rgb(0, 0, 0); ">10</span><span style="color: rgb(0, 0, 0); ">))
</span><span style="color: rgb(0, 128, 128); ">58</span> <span style="color: rgb(0, 0, 0); ">event.when.append(gdata.calendar.When(start_time</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">start_time, end_time</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">end_time))
</span><span style="color: rgb(0, 128, 128); ">59</span> <span style="color: rgb(0, 0, 0); ">new_event </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> cal_client.InsertEvent(event,insert_uri</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">calname)
</span><span style="color: rgb(0, 128, 128); ">60</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">添加提醒</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">61</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">for a_when in new_event.when:</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">62</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">if len(a_when.reminder) &gt; 0:</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">63</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">a_when.reminder[0].minutes = 0</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">64</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">else:</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">65</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">a_when.reminder.append(gdata.calendar.Reminder(minutes=0))</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">66</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); ">cal_client.UpdateEvent(new_event.GetEditLink().href, new_event)
</span><span style="color: rgb(0, 128, 128); ">67</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">68</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> QQonline(qq</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(128, 0, 0); ">313057725</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(0, 0, 0); ">):
</span><span style="color: rgb(0, 128, 128); ">69</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">try</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">70</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">if</span><span style="color: rgb(0, 0, 0); "> urlopen(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); "><a href="http://wpa.qq.com/pa?p=1:" target="_blank">http://wpa.qq.com/pa?p=1:</a></span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">+</span><span style="color: rgb(0, 0, 0); ">qq</span><span style="color: rgb(0, 0, 0); ">+</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">:41</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">).info().getheader(</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(128, 0, 0); ">Content-Length</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(0, 0, 0); ">).find(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">1243</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">)</span><span style="color: rgb(0, 0, 0); ">!=-</span><span style="color: rgb(0, 0, 0); ">1</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">71</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">return</span><span style="color: rgb(0, 0, 0); "> True
</span><span style="color: rgb(0, 128, 128); ">72</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">else</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">73</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">return</span><span style="color: rgb(0, 0, 0); "> False
</span><span style="color: rgb(0, 128, 128); ">74</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">except</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">75</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">return</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">76</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">77</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">78</span> <span style="color: rgb(0, 0, 0); ">application </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> webapp.WSGIApplication([(r</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(128, 0, 0); ">/.*</span><span style="color: rgb(128, 0, 0); ">'</span><span style="color: rgb(0, 0, 0); ">, MainFrame)],debug</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">True)
</span><span style="color: rgb(0, 128, 128); ">79</span> <span style="color: rgb(0, 0, 0); ">handlers.CGIHandler().run(application)</span></span></div></div><div><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', monospace; line-height: normal; font-size: 12px; white-space: pre; "><span style="color: rgb(0, 0, 0); "><br/></span></span></div><div><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', monospace; line-height: normal; font-size: 12px; white-space: pre; "><span style="color: rgb(0, 0, 0); "><br/></span></span></div><div><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', monospace; line-height: normal; font-size: 12px; white-space: pre; "><span style="color: rgb(0, 0, 0); "><br/></span></span></div><div><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', monospace; line-height: normal; font-size: 12px; white-space: pre; "><span style="color: rgb(0, 0, 0); "><span style="color: rgb(0, 128, 128); "> 1</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">coding:utf-8</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); "> 2</span> <span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">暂时先不考虑效率</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); "> 3</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> cPickle as pickle
</span><span style="color: rgb(0, 128, 128); "> 4</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">from</span><span style="color: rgb(0, 0, 0); "> google.appengine.ext </span><span style="color: rgb(0, 0, 255); ">import</span><span style="color: rgb(0, 0, 0); "> db
</span><span style="color: rgb(0, 128, 128); "> 5</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">class</span><span style="color: rgb(0, 0, 0); "> GAME(db.Model):
</span><span style="color: rgb(0, 128, 128); "> 6</span> <span style="color: rgb(0, 0, 0); ">name </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> db.StringProperty(multiline</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">True)
</span><span style="color: rgb(0, 128, 128); "> 7</span> <span style="color: rgb(0, 0, 0); ">value </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> db.StringProperty(multiline</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">True)
</span><span style="color: rgb(0, 128, 128); "> 8</span> <span style="color: rgb(0, 0, 0); ">type</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> db.StringProperty(multiline</span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); ">True)
</span><span style="color: rgb(0, 128, 128); "> 9</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">10</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 0, 255); ">class</span><span style="color: rgb(0, 0, 0); "> data():
</span><span style="color: rgb(0, 128, 128); ">11</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">这些是对GQL简单而有效的Python封装</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">12</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 128); ">__getattr__</span><span style="color: rgb(0, 0, 0); ">(self,name):
</span><span style="color: rgb(0, 128, 128); ">13</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">14</span> <span style="color: rgb(0, 0, 0); "> greeting </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> db.GqlQuery(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">SELECT * FROM GAME</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">)
</span><span style="color: rgb(0, 128, 128); ">15</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">for</span><span style="color: rgb(0, 0, 0); "> i </span><span style="color: rgb(0, 0, 255); ">in</span><span style="color: rgb(0, 0, 0); "> greeting:
</span><span style="color: rgb(0, 128, 128); ">16</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">if</span><span style="color: rgb(0, 0, 0); "> i.name</span><span style="color: rgb(0, 0, 0); ">==</span><span style="color: rgb(0, 0, 0); ">name:
</span><span style="color: rgb(0, 128, 128); ">17</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">return</span><span style="color: rgb(0, 0, 0); "> pickle.loads(i.value.encode(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">gbk</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">))
</span><span style="color: rgb(0, 128, 128); ">18</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">else</span><span style="color: rgb(0, 0, 0); ">:
</span><span style="color: rgb(0, 128, 128); ">19</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">return</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">20</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">raise</span><span style="color: rgb(0, 0, 0); "> ValError,</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">No this value in the class</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">21</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 128); ">__setattr__</span><span style="color: rgb(0, 0, 0); ">(self,name,value):
</span><span style="color: rgb(0, 128, 128); ">22</span> <span style="color: rgb(0, 0, 0); ">greeting </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> db.GqlQuery(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">SELECT * FROM GAME</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">)
</span><span style="color: rgb(0, 128, 128); ">23</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">for</span><span style="color: rgb(0, 0, 0); "> i </span><span style="color: rgb(0, 0, 255); ">in</span><span style="color: rgb(0, 0, 0); "> greeting:
</span><span style="color: rgb(0, 128, 128); ">24</span> <span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(0, 0, 255); ">if</span><span style="color: rgb(0, 0, 0); "> i.name</span><span style="color: rgb(0, 0, 0); ">==</span><span style="color: rgb(0, 0, 0); ">name:
</span><span style="color: rgb(0, 128, 128); ">25</span> <span style="color: rgb(0, 0, 0); ">db.delete(i)
</span><span style="color: rgb(0, 128, 128); ">26</span> <span style="color: rgb(0, 0, 0); ">greeting </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> GAME()
</span><span style="color: rgb(0, 128, 128); ">27</span> <span style="color: rgb(0, 0, 0); ">greeting.name </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> name
</span><span style="color: rgb(0, 128, 128); ">28</span> <span style="color: rgb(0, 0, 0); ">greeting.value </span><span style="color: rgb(0, 0, 0); ">=</span><span style="color: rgb(0, 0, 0); "> pickle.dumps(value,True).decode(</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(128, 0, 0); ">gbk</span><span style="color: rgb(128, 0, 0); ">"</span><span style="color: rgb(0, 0, 0); ">)
</span><span style="color: rgb(0, 128, 128); ">29</span> <span style="color: rgb(0, 0, 0); ">greeting.put()
</span><span style="color: rgb(0, 128, 128); ">30</span> <span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">31</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">def</span><span style="color: rgb(0, 0, 0); "> </span><span style="color: rgb(128, 0, 128); ">__delattr__</span><span style="color: rgb(0, 0, 0); ">(self,name):
</span><span style="color: rgb(0, 128, 128); ">32</span> <span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">还没用到，有兴趣的自己写</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">33</span> <span style="color: rgb(0, 128, 0); "/><span style="color: rgb(0, 0, 0); "></span><span style="color: rgb(0, 0, 255); ">pass</span><span style="color: rgb(0, 0, 0); ">
</span><span style="color: rgb(0, 128, 128); ">34</span> <span style="color: rgb(0, 0, 0); "/><span style="color: rgb(0, 128, 0); ">#</span><span style="color: rgb(0, 128, 0); ">a.__dict__['x']</span><span style="color: rgb(0, 128, 0); ">
</span><span style="color: rgb(0, 128, 128); ">35</span> </span></span></div><div><font class="Apple-style-span" color="#000000" face="'Courier New', monospace" size="3"><span class="Apple-style-span" style="font-size: 12px; line-height: normal; white-space: pre;"><br/></span></font></div></span>&#13;
                                                &#13;
                                            </div>&#13;
										